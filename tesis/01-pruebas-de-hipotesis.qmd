# Pruebas de hipótesis {.unnumbered}

Uno de los pasos del **Análisis Exploratorio de Datos Espaciales** (_ESDA_ por
sus siglas en inglés) es probar si los datos geográficos cuentan con algún
tipo de estructura espacial. Hacerlo es importante ya que si en efecto existe
estructura espacial en los datos, entonces esta se debe incorporar en todo
el análisis.

Sin embargo, antes de entrar en detalle sobre qué es la estructura espacial
primero es importante definir su contraparte, la **aleatorieda espacial**
(_spatial randomness_).

## Aleatoriedad espacial

Es la ausencia de cualquier tipo de patrón espacial en los datos, y debe
satisfacer dos condiciones:

* Las observaciones son equiprobables de ocurrir en cualquer ubicación en el
espacio.
* El valor de una observación no depende de sus vecinos.

Para propósitos de análisis, es de interés encontrar evidencia en contra de
aleatoriedad espacial ya que esto indicaría que existe estructura espacial
en lo datos.

## Base de pruebas de hipótesis

Dado que es de interés encontrar evidencia en contra de aleatoriedad espacial,
entonces es posible apalancarse de la [1° ley geográfica de Tobler](https://en.wikipedia.org/wiki/Tobler%27s_first_law_of_geography)
para el planteamiento de una prueba hipótesis, misma que establece que en un
espacio geográfico "_Todo está relacionado con todo, pero las cosas más cercanas aún más_".
Bajo esta ley se pueden extraer dos conclusiones importantes:

1. En un contexto geográfico hay estructuras con dependencia espacial.
2. Existe decaemiento en la correlación de las cosas con la distancia, es
decir, observaciones más separadas estarán menos asociadas.

Estos puntos resultan en el planteamiento de la **prueba de hipótesis** básica
para datos geoespaciales:

* $H_0$: Los datos se distribuyen bajo aleatoriedad espacial.
* $H_1$: Los datos presentan algún tipo de estructura espacial.

Misma que se fundamenta en determinar la **autocorrelación espacial** de los
datos.

## Autocorrelación espacial

Busca medir la variación de una misma variable en ubicaciones distintas, y
puede tomar valores tanto positivos como negativos. Esto lleva a la
interpretación de tres posibles casos:

![Casos de autocorrelación espacial](./figuras/01/autocorrelacion_espacial.png)

* Autocorrelación **positiva**: Se da cuando las observaciones de una vecindad
tienen valores similares sean negativos (_cold spot_) o positivos (_hot spot_),
con mayor frecuencia que en aleatoriedad espacial, lo cual resulta en la
presencia de **segmentos geográficos** (_clusters_).

* Autocorrelación **nula**: No existe autocorrelación en los datos por lo que
hay aleatoriedad espacial.

* Autocorrelación **negativa**: Se da cuando las observaciones de una vecindad
tienen **valores alternantes** con mayor frecuencia que en aleatoriedad
espacial, lo cual resulta en estructuras tipo tablero de ajedrez.

### Estadísticos para autocorrelación espacial

Recordando que un **estadístico** es cualquier valor que resume alguna
característica de una distribución de referencia ($H_0$), entonces un
**estadístico de prueba** es aquel que se calcula de los datos y se compara con
esa misma distribución buscando responder a la pregunta:

>¿Qué tan probable es obtener el estadístico de prueba si éste proviniera
>de datos generados de la distribución de referencia $H_0$?

Éste entonces acepta o rechaza $H_0$ en función de si la probabilidad de
observar esos datos supera o no la región de rechazo en la distribución de
referencia.

Para construir un estadístico de prueba en un contexto espacial es
necesario que éste capture tanto la **similitud de atributos** como la
**similitud de ubicación** de una variable consigo misma pero en ubicaciones
distintas, de ahí que sea **auto**correlación en contraste con otros
estadísticos como pudiera ser la correlación de Pearson.

#### Similitud de atributos

Busca resumir la similitud de diferentes observaciones de una misma variable
$x$ en diferentes ubicaciones $i$, $j$, de modo que es una función
$f(x_i, x_j)$

#### Similitud de ubicación

Formaliza la noción de un vecino a través de los **pesos espaciales** 
($w_{ij}$) que se almacenan en la matriz de pesos espaciales $W$ a través
de algún tipo de interacción.

Con estas dos partes se puede construir un estadístico $z$ que sume a lo
largo de todos los pares de observaciones $(i, j)$ el producto de la similitud
de atributos con la similitud de ubicación, de modo que:

$$z = \sum_{ij}f(x_i,x_j)\cdot w_{ij}$$

::: {.callout-important}
A la hora de plantear estos enfoques se deriva una complicación fundamental
debida al **problema de parámetros incidentales**. Para entenderlo, se debe
recordar que la autocorrelación espacial se sustenta en definir la interacción
entre pares de observaciones para todas las $n\cdot(\frac{n-1}{2})$ duplas
posibles en un espacio geográfico.

La relación entre todos los posibles pares de observaciones se almacena en una
matriz de interacciones de dimensiones $n\times n$ siendo cada elemento un parámetro
del problema. Esto hace evidente que para un conjunto de $n$ observaciones, el
número de parámetros crecería con un factor de $n^2$.
:::

### Pesos espaciales

La solución al problema anterior radica en imponer algún tipo de estructura a
los datos para limitar el número de parámetros por estimar, es aquí en donde
los **pesos espaciales** desempeñan un papel esencial al formalizar la noción
de vecinos. Fundamentalmente, los pesos espaciales están diseñados para
**excluir algunas interacciones** al limitar el número de vecinos de una
observación, por ejemplo, considerando aquellas ubicaciones con las que
comparte una frontera.

Entonces, el **grado de interacción** entre pares de observaciones queda
definido por un efecto combinado entre el **coeficiente de correlación**
(asociado a la similitud de atributos), y su **peso** (asociado a la similitud
de ubicación).

Una vez comprendida la definición de pesos, el siguiente paso es
construir la **matriz de pesos espaciales** basada en algún tipo de criterio,
que también es una matríz de dimensiones $n\times n$ en donde se almacena a
cada peso $w_{ij}$ y que cumple con las siguientes características:

* $w_{ij}\neq 0$ para vecinos.
* $w_{ij} = 0$ implica que $i$ y $j$ no son vecinos.
* $w_{ii} = 0$ dado que no hay similitud entre una observación consigo misma.

Esto provoca que $W$ sea una **matriz rala** ya que gran número de sus
elementos son $0$, estos anulan la interacción entre múltiples observaciones
reduciendo, consecuentemente, el número de parámetros por estimar.

Con lo anterior, resta definir las reglas para construir $W$ para lo cual
existen múltiples **criterios de contigüidad**.

### Criterios de contigüidad
